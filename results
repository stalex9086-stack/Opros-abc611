<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Результаты голосования</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";
    const firebaseConfig = {
      apiKey: "AIzaSyBXa2ZCZ8QlSPqXZXWtiAbDJk9HpP4P5A0",
      authDomain: "opros-abc611-6e34a.firebaseapp.com",
      databaseURL: "https://opros-abc611-6e34a-default-rtdb.firebaseio.com",
      projectId: "opros-abc611-6e34a",
      storageBucket: "opros-abc611-6e34a.firebasestorage.app",
      messagingSenderId: "892292768205",
      appId: "1:892292768205:web:b0f3147df004a7ac48a484",
      measurementId: "G-2EQTN4TGBL"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    function loadResults() {
      const themesRef = ref(db, 'themes');
      get(themesRef).then(snapshot => {
        let themes = (snapshot.exists() ? snapshot.val() : []);
        const resultList = document.getElementById('resultList');
        resultList.innerHTML = "";
        themes.forEach((theme, idx) => {
          const refVotes = ref(db, 'votes/' + idx);
          get(refVotes).then(snapshot2 => {
            let cnt = snapshot2.exists() ? snapshot2.val() : 0;
            const div = document.createElement('div');
            div.textContent = `${theme || "Без названия"}: ${cnt}`;
            resultList.appendChild(div);
          });
        });
      });
    }

    document.addEventListener('DOMContentLoaded', loadResults);
    setInterval(loadResults, 3000);
  </script>
</head>
<body>
  <h2>Результаты голосования</h2>
  <div id="resultList"></div>
</body>
</html>
