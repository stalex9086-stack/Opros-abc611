<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Онлайн голосование через QR-код</title>
  <script type="module">
    // Ваш импорт
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getDatabase, ref, push, onValue, set, get } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";
    
    // Конфиг из вашего сообщения
    const firebaseConfig = {
      apiKey: "AIzaSyBXa2ZCZ8QlSPqXZXWtiAbDJk9HpP4P5A0",
      authDomain: "opros-abc611-6e34a.firebaseapp.com",
      databaseURL: "https://opros-abc611-6e34a-default-rtdb.firebaseio.com",
      projectId: "opros-abc611-6e34a",
      storageBucket: "opros-abc611-6e34a.firebasestorage.app",
      messagingSenderId: "892292768205",
      appId: "1:892292768205:web:b0f3147df004a7ac48a484",
      measurementId: "G-2EQTN4TGBL"
    };

    // Инициализация
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Темы для голосования
    const themes = [
      "Искусственный интеллект и будущее работы",
      "Экологичные технологии",
      "Мобильные приложения для образования",
      "Личный финансовый менеджмент",
      "ЗОЖ и физическая активность",
      "Интернет-безопасность и защита данных"
    ];

    // Вывод тем
    document.addEventListener('DOMContentLoaded', () => {
      const themeList = document.getElementById('themeList');
      themes.forEach((theme, idx) => {
        const btn = document.createElement('button');
        btn.textContent = theme;
        btn.onclick = () => vote(idx);
        themeList.appendChild(btn);
      });
      loadResults();
    });

    // Голосование
    function vote(idx) {
      const refVotes = ref(db, 'votes/' + idx);
      get(refVotes).then(snapshot => {
        let cnt = snapshot.exists() ? snapshot.val() : 0;
        set(refVotes, cnt + 1);
      }).then(loadResults);
      alert("Спасибо, ваш голос учтен!");
    }

    // Загрузка и вывод результатов
    function loadResults() {
      const resultList = document.getElementById('resultList');
      resultList.innerHTML = "";
      themes.forEach((theme, idx) => {
        const refVotes = ref(db, 'votes/' + idx);
        get(refVotes).then(snapshot => {
          let cnt = snapshot.exists() ? snapshot.val() : 0;
          const div = document.createElement('div');
          div.textContent = theme + ": " + cnt;
          resultList.appendChild(div);
        });
      });
    }

    // Авто-обновление
    setInterval(loadResults, 3000);
  </script>
</head>
<body>
  <h2>Онлайн голосование по темам</h2>
  <div id="themeList"></div>
  <h2>Результаты:</h2>
  <div id="resultList"></div>
</body>
</html>
